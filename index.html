<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For BbubğŸ«¶ğŸ»</title>

  <style>
    :root{
      --glass: rgba(255,255,255,.16);
      --glass-2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.35);
      --shadow: rgba(0,0,0,.28);
      --text: rgba(255,255,255,.94);
      --text-soft: rgba(255,255,255,.82);
      --pink: #ff6a88;
      --pink2:#ff99ac;

      --ok: rgba(88,255,176,.92);
      --warn: rgba(255,211,106,.92);
      --danger: rgba(255,110,126,.92);
      --ring: rgba(255,255,255,.22);
    }

    *{ box-sizing:border-box; }

    html, body { height: 100%; }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      overflow:hidden;
      padding: 18px;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(255,255,255,.16), transparent 60%),
        radial-gradient(900px 500px at 90% 20%, rgba(255,255,255,.12), transparent 55%),
        linear-gradient(135deg, #667eea, #f797b4);
    }

    body::after{
      content:"";
      position:fixed;
      inset:-40px;
      pointer-events:none;
      background: radial-gradient(900px 600px at 50% 40%, transparent 40%, rgba(0,0,0,.18) 100%);
      z-index:0;
    }

    /* soft noise */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 1;
      opacity: .08;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      background-size: 220px 220px;
      mix-blend-mode: overlay;
    }

    .heart{
      position:absolute;
      top:110vh;
      opacity:.55;
      animation: floatUp linear infinite;
      pointer-events:none;
      user-select:none;
      z-index:0;
      will-change: transform;
    }
    @keyframes floatUp{
      from { transform: translateY(0) translateX(0) rotate(0deg); }
      to   { transform: translateY(-135vh) translateX(60px) rotate(22deg); }
    }

    .sparkle{
      position:absolute;
      top:110vh;
      width:3px;
      height:3px;
      border-radius:999px;
      background: rgba(255,255,255,.8);
      opacity:.5;
      animation: sparkleUp linear infinite;
      z-index:0;
      filter: blur(.2px);
    }
    @keyframes sparkleUp{
      from { transform: translateY(0); opacity: .15; }
      30%  { opacity: .55; }
      to   { transform: translateY(-135vh); opacity: .05; }
    }

    /* gentle blobs */
    .blob{
      position: fixed;
      width: 520px;
      height: 520px;
      border-radius: 999px;
      filter: blur(40px);
      opacity: .22;
      z-index: 0;
      pointer-events:none;
      animation: drift 10s ease-in-out infinite alternate;
    }
    .blob.b1{
      left: -140px;
      top: -160px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), transparent 55%),
                  radial-gradient(circle at 70% 70%, rgba(255,122,160,.55), transparent 55%);
    }
    .blob.b2{
      right: -180px;
      bottom: -220px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.38), transparent 55%),
                  radial-gradient(circle at 70% 70%, rgba(120,170,255,.55), transparent 55%);
      animation-duration: 12s;
    }
    @keyframes drift{
      from { transform: translate(0,0) scale(1); }
      to   { transform: translate(18px,-14px) scale(1.03); }
    }

    .card{
      width:min(560px, 94vw);
      padding: 26px 24px 18px;
      border-radius: 28px;
      background: linear-gradient(135deg, var(--glass), var(--glass-2));
      border: 1px solid var(--stroke);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 24px 60px var(--shadow);
      text-align:center;
      position:relative;
      z-index:2;
      overflow:hidden;
      animation: enter .55s ease both;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(480px 200px at 20% 10%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(420px 220px at 90% 0%, rgba(255,255,255,.12), transparent 60%);
      pointer-events:none;
      z-index:-1;
    }
    /* subtle border glow */
    .card::after{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: 30px;
      background: radial-gradient(220px 120px at 25% 0%, rgba(255,255,255,.25), transparent 60%),
                  radial-gradient(240px 140px at 85% 10%, rgba(255,255,255,.16), transparent 60%);
      pointer-events:none;
      z-index:-1;
      mix-blend-mode: screen;
      opacity: .55;
    }

    @keyframes enter{
      from { transform: translateY(10px) scale(.985); opacity: 0; }
      to   { transform: translateY(0) scale(1); opacity: 1; }
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      color: rgba(255,255,255,.88);
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.28);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .chip{
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.28);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.9);
      display:flex;
      align-items:center;
      gap: 8px;
    }

    .chipBtn{
      border: 1px solid rgba(255,255,255,.28);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      cursor:pointer;
      transition: transform .18s ease, filter .18s ease;
    }
    .chipBtn:hover{ transform: translateY(-1px); filter: brightness(1.04); }

    h1{
      margin: 6px 0 8px;
      font-size: clamp(22px, 4vw, 30px);
      letter-spacing: .2px;
    }

    p{
      margin: 0 0 16px;
      font-size: 15px;
      line-height: 1.6;
      color: var(--text-soft);
    }

    .note{
      margin: 12px auto 0;
      font-size: 13px;
      color: rgba(255,255,255,.86);
      line-height: 1.45;
    }

    .divider{
      height: 1px;
      background: rgba(255,255,255,.22);
      margin: 16px 0 18px;
      border-radius: 99px;
    }

    .progressWrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top: 4px;
      gap: 12px;
    }

    .progressLabel{
      font-size: 12px;
      color: rgba(255,255,255,.85);
      white-space: nowrap;
      opacity: .95;
    }

    .progress{
      flex:1;
      height: 9px;
      background: rgba(255,255,255,.22);
      border-radius: 999px;
      overflow:hidden;
    }

    .progress-bar{
      height:100%;
      width:0%;
      background: rgba(255,255,255,.92);
      border-radius: 999px;
      transition: width .35s ease;
    }

    .question{
      font-size: 17px;
      font-weight: 750;
      line-height: 1.35;
      margin: 10px 0 16px;
      letter-spacing: .1px;
    }

    .buttons{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap: 12px;
      margin-top: 10px;
    }

    button{
      border:none;
      border-radius: 999px;
      padding: 11px 18px;
      font-size: 14px;
      cursor:pointer;
      transition: transform .18s ease, filter .18s ease, box-shadow .18s ease;
      color: rgba(255,255,255,.95);
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover{ transform: translateY(-1px) scale(1.03); filter: brightness(1.03); }
    button:active{ transform: translateY(0) scale(.99); }

    .primary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      font-weight: 800;
      box-shadow: 0 10px 26px rgba(255, 105, 135, .45);
    }

    .secondary{
      background: linear-gradient(135deg, rgba(255,255,255,.26), rgba(255,255,255,.12));
      border: 1px solid rgba(255,255,255,.38);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .ghost{
      background: transparent;
      border: 1px solid rgba(255,255,255,.35);
      color: rgba(255,255,255,.9);
    }

    .hidden{ display:none; }

    /* toast */
    .toast{
      position: fixed;
      left: 50%;
      top: 18px;
      transform: translateX(-50%);
      z-index: 50;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.26);
      background: rgba(20,20,30,.30);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 14px 30px rgba(0,0,0,.22);
      display:flex;
      align-items:center;
      gap: 10px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      color: rgba(255,255,255,.92);
      font-size: 13px;
      white-space: nowrap;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(4px);
    }
    .toast .dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      box-shadow: 0 0 0 4px rgba(255,255,255,.12);
    }

    .summary{
      text-align:left;
      margin-top: 12px;
      font-size: 14px;
      line-height: 1.6;
      color: rgba(255,255,255,.9);
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.26);
      background: rgba(255,255,255,.07);
    }

    .summary strong{ color: rgba(255,255,255,.95); }

    .summary .row{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(255,255,255,.18);
    }
    .summary .row:last-child{ border-bottom: none; }
    .summary .k{ opacity: .85; }
    .summary .v{ font-weight: 700; text-align:right; }

    .confetti{
      margin-top: 14px;
      font-size: 22px;
      animation: pop .65s ease-in-out infinite alternate;
      text-shadow: 0 8px 20px rgba(0,0,0,.25);
    }
    @keyframes pop{
      from{ transform: translateY(0); }
      to{ transform: translateY(-7px); }
    }

    .footer{
      margin-top: 14px;
      font-size: 12px;
      color: rgba(255,255,255,.75);
      opacity: .95;
    }

    /* pickers */
    .pickerCard{
      margin-top: 14px;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.26);
      background: rgba(255,255,255,.07);
      text-align:left;
    }
    .pickerTitle{
      font-weight: 800;
      margin-bottom: 10px;
      color: rgba(255,255,255,.95);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .miniLink{
      font-size: 12px;
      opacity: .9;
      cursor:pointer;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
      user-select:none;
    }
    .miniLink:hover{ filter: brightness(1.06); }

    .pickerGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .field label{
      display:block;
      font-size: 12px;
      opacity: .9;
      margin-bottom: 6px;
    }
    .field input{
      width: 100%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.28);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
      outline: none;
      font-size: 14px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .field input:focus{
      border-color: rgba(255,255,255,.45);
      box-shadow: 0 0 0 3px rgba(255,255,255,.12);
    }
    .hint{
      margin-top: 10px;
      font-size: 12px;
      opacity: .88;
      color: rgba(255,255,255,.86);
      line-height: 1.45;
    }

    .fadeOut{ animation: fadeOut .35s ease forwards; }
    @keyframes fadeOut{ to { opacity: 0; transform: translateY(-6px); } }

    /* extra page: special message */
    .messageCard{
      margin-top: 14px;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.26);
      background: rgba(255,255,255,.07);
      text-align:left;
    }
    .messageTitle{
      font-weight: 850;
      margin-bottom: 8px;
      color: rgba(255,255,255,.95);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .messageBody{
      font-size: 14px;
      line-height: 1.6;
      color: rgba(255,255,255,.88);
    }
    .msgSmall{
      font-size: 12px;
      opacity: .88;
      margin-top: 10px;
    }

    /* modal (playlist / mini options) */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.28);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 80;
    }
    .modal.show{ display:flex; }
    .modalCard{
      width: min(520px, 96vw);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(20,20,30,.38);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 24px 60px rgba(0,0,0,.32);
      overflow:hidden;
      animation: enter .22s ease both;
    }
    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.14);
    }
    .modalTop .t{
      font-weight: 900;
      letter-spacing: .2px;
    }
    .modalClose{
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 13px;
      cursor:pointer;
    }
    .modalBody{
      padding: 14px 14px 16px;
      color: rgba(255,255,255,.9);
      text-align:left;
      font-size: 14px;
      line-height: 1.6;
    }
    .modalGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .tile{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 12px;
      cursor:pointer;
      user-select:none;
      transition: transform .16s ease, filter .16s ease;
    }
    .tile:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .tile .small{ font-size: 12px; opacity: .86; margin-top: 4px; }

    /* no button wrap for valentine page */
    .no-wrap{ position: relative; display:inline-block; }

    /* tiny shake for "No" attempt */
    .shake{
      animation: shake .28s ease-in-out;
    }
    @keyframes shake{
      0%{ transform: translate(0,0); }
      30%{ transform: translate(2px,-1px); }
      60%{ transform: translate(-2px,1px); }
      100%{ transform: translate(0,0); }
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
    }
  </style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>

  <div class="toast" id="toast"><span class="dot"></span><span id="toastText">Saved ğŸ’Œ</span></div>

  <div class="card" id="card">
    <div class="topbar">
      <div class="badge">ğŸ’Œ <span id="stepText">A tiny date quiz</span></div>

      <div class="chip" id="timeChip">
        âœ¨
        <button class="chipBtn" onclick="openMiniMenu()" aria-label="Open menu">â‹¯</button>
      </div>
    </div>

    <!-- PAGE 1: INTRO -->
    <div id="intro">
      <h1>Hi BbubğŸ«¶ğŸ»</h1>
      <p>
        This coming Valentineâ€™s Day, I know you already have errands â€”
        but Iâ€™d love to take you out on a date whenever youâ€™re free.
      </p>

      <div class="note">ğŸ“¹ Take note: please screen record while answering the questions ğŸ˜‰</div>
      <div class="divider"></div>

      <div class="buttons" id="startArea">
        <button class="primary" onclick="startQuestions()">Start ğŸ’Œ</button>
        <button class="secondary" onclick="skipToPick()">Skip to date/time â°</button>
      </div>

      <div class="footer">Small reminder: you can always go back and change answers âœ¨</div>
    </div>

    <!-- PAGE 2: QUIZ -->
    <div id="quiz" class="hidden">
      <div class="progressWrap">
        <div class="progressLabel" id="progressLabel">Question 1 of 7</div>
        <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
      </div>

      <div class="question" id="questionText"></div>
      <div class="buttons" id="answerButtons"></div>

      <div class="buttons">
        <button class="ghost" onclick="goBack()" id="backBtn" disabled>â† Back</button>
        <button class="ghost" onclick="restart()" title="Start over">â†º Restart</button>
      </div>

      <div class="footer">Tip: choose what feels right â€” weâ€™ll build the date together âœ¨</div>
    </div>

    <!-- PAGE 3: PICK DATE & TIME -->
    <div id="final" class="hidden">
      <h1>Pick Date &amp; Time ğŸ’Œ</h1>

      <div class="pickerCard">
        <div class="pickerTitle">
          <span>Pick our date &amp; time ğŸ’Œ</span>
          <span class="miniLink" onclick="suggestTimes()">Suggest âœ¨</span>
        </div>

        <div class="pickerGrid">
          <div class="field">
            <label for="datePick">Date</label>
            <input id="datePick" type="date" />
          </div>

          <div class="field">
            <label for="timePick">Time</label>
            <input id="timePick" type="time" />
          </div>
        </div>

        <div class="hint">Choose what works for you. Iâ€™ll adjust ğŸ«¶ğŸ»</div>
      </div>

      <div class="buttons">
        <button class="primary" onclick="goToExtraMessage()">Next ğŸ’</button>
        <button class="ghost" onclick="backToQuiz()">â† Back</button>
      </div>

      <div class="footer" id="footerFinal">Made for BbubğŸ«¶ğŸ» âœ¨</div>
    </div>

    <!-- PAGE 3.5: SWEET MESSAGE -->
    <div id="extraMessage" class="hidden">
      <h1>One more thingâ€¦ ğŸ«¶ğŸ»</h1>

      <div class="messageCard">
        <div class="messageTitle">
          <span>A little note for you ğŸ’—</span>
          <span class="miniLink" onclick="typeMessage()">Type it âœ¨</span>
        </div>

        <div class="messageBody" id="messageBody">
          I know life gets busy, but I just want you to know: Iâ€™m proud of you.
          Iâ€™m not here to rush youâ€”only to choose you, gently, every day.
        </div>

        <div class="msgSmall">P.S. You can press â€œType it âœ¨â€ if you want the message to appear like a cute typing effect ğŸ˜Œ</div>
      </div>

      <div class="buttons">
        <button class="primary" onclick="goToValentine()">Next ğŸ’˜</button>
        <button class="ghost" onclick="backToFinal()">â† Back</button>
      </div>

      <div class="footer">You + me + a simple date = perfect ğŸ˜Œ</div>
    </div>

    <!-- PAGE 4: VALENTINE (YES/NO with moving NO) -->
    <div id="valentine" class="hidden">
      <h1>Soâ€¦ will you be my Valentine? ğŸ’–</h1>
      <p style="margin-bottom:10px;">
        Just one last questionâ€¦ ğŸ«¶ğŸ»
      </p>

      <div class="buttons">
        <button class="primary" onclick="goToLoveReceipt()">Yes ğŸ’˜</button>

        <span class="no-wrap">
          <button class="secondary no-btn" id="noBtn"
            onmouseenter="moveNo()"
            ontouchstart="moveNo(); return false;"
            onclick="noTry()"
          >
            No ğŸ˜œ
          </button>
        </span>
      </div>

      <div class="footer">No pressureâ€¦ but alsoâ€¦ yes please ğŸ˜Œ</div>
    </div>

    <!-- PAGE 5: RECEIPT + CONFIRM -->
    <div id="loveReceiptPage" class="hidden">
      <h1>Our Little Love Receipt ğŸ’Œ</h1>
      <p style="margin-bottom:10px;">
        Just to make sure everything looks perfectâ€¦ ğŸ«¶ğŸ»
      </p>

      <div class="summary" id="loveReceiptBox"></div>

      <div class="buttons">
        <button class="primary" onclick="confirmEverything()">Confirm ğŸ’</button>
        <button class="ghost" onclick="backToValentine()">â† Back</button>
        <button class="secondary" onclick="copyReceipt()">Copy receipt ğŸ“‹</button>
      </div>

      <div id="celebrate" class="hidden confetti">See you on our date, I'm so excited ğŸ’•</div>
      <div class="footer" id="footerReceipt">Made for BbubğŸ«¶ğŸ» âœ¨</div>
    </div>
  </div>

  <!-- Mini menu modal -->
  <div class="modal" id="miniMenu" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="modalTop">
        <div class="t">Little menu âœ¨</div>
        <button class="modalClose" onclick="closeMiniMenu()">Close</button>
      </div>

      <div class="modalBody">
        <div style="opacity:.92;">Choose a tiny extra:</div>

        <div class="modalGrid">
          <div class="tile" onclick="toggleAmbience()">
            <div><strong id="ambienceTitle">Ambience: ON</strong> ğŸŒ™</div>
            <div class="small">Turns background hearts/sparkles on/off.</div>
          </div>

          <div class="tile" onclick="surpriseCompliment()">
            <div><strong>Give me a compliment</strong> ğŸ«¶ğŸ»</div>
            <div class="small">A random sweet line.</div>
          </div>

          <div class="tile" onclick="jumpToReceipt()">
            <div><strong>Jump to receipt</strong> ğŸ’Œ</div>
            <div class="small">If you already answered everything.</div>
          </div>
        </div>

        <div class="hint" style="margin-top:12px;">
          Tip: long-press â€œNo ğŸ˜œâ€ still wonâ€™t work ğŸ˜Œ
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---- Floating background (hearts + sparkles) ----
    let ambienceOn = true;
    const spawned = { hearts: [], sparkles: [] };

    (function spawnBackground(){
      const hearts = 24, sparkles = 28;

      for (let i = 0; i < hearts; i++) {
        const heart = document.createElement('div');
        heart.className = 'heart';
        heart.textContent = (Math.random() > 0.75) ? 'ğŸ’•' : 'ğŸ’–';

        const size = 14 + Math.random() * 22;
        heart.style.fontSize = size + 'px';
        heart.style.left = (Math.random() * 100) + 'vw';
        heart.style.opacity = (0.20 + Math.random() * 0.55).toFixed(2);
        heart.style.filter = `blur(${(Math.random() * 1.1).toFixed(2)}px)`;

        const dur = 7 + Math.random() * 8;
        const delay = Math.random() * 7;
        heart.style.animationDuration = dur + 's';
        heart.style.animationDelay = (-delay) + 's';

        document.body.appendChild(heart);
        spawned.hearts.push(heart);
      }

      for (let i = 0; i < sparkles; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = (Math.random() * 100) + 'vw';

        const dur = 6 + Math.random() * 8;
        const delay = Math.random() * 8;
        s.style.animationDuration = dur + 's';
        s.style.animationDelay = (-delay) + 's';

        const size = 2 + Math.random() * 2.5;
        s.style.width = size + 'px';
        s.style.height = size + 'px';

        s.style.opacity = (0.15 + Math.random() * 0.45).toFixed(2);
        document.body.appendChild(s);
        spawned.sparkles.push(s);
      }
    })();

    function setAmbienceVisible(on){
      [...spawned.hearts, ...spawned.sparkles].forEach(el => {
        el.style.display = on ? '' : 'none';
      });
    }

    // ---- Toast ----
    let toastTimer = null;
    function toast(msg="Saved ğŸ’Œ"){
      const t = document.getElementById('toast');
      const tx = document.getElementById('toastText');
      tx.textContent = msg;
      t.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove('show'), 1400);
    }

    // ---- Time chip ----
    (function setTimeChip(){
      const el = document.getElementById('timeChip');
      const now = new Date();
      const timeStr = now.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
      // keep the menu button intact (it's inside chip)
      el.childNodes[0].textContent = `â° ${timeStr} `;
    })();

    // ---- Questions ----
    const questions = [
      { key:"Dinner", text: "What would you like for dinner? ğŸ´", answers: ["Pork ğŸ·", "Beef ğŸ¥©", "Chicken ğŸ“", "Seafoods ğŸ¦", "Anything you pick ğŸ˜Œ"] },
      { key:"Outfit", text: "What color should we wear to match? ğŸ‘—", answers: ["Blue ğŸ©µ", "Red ğŸ©·", "White ğŸ¤", "Black ğŸ–¤", "Pastel ğŸŒ¸"] },
      { key:"After",  text: "Where should we go after dinner? ğŸŒƒ", answers: ["Coffee shop â˜•", "Dessert place ğŸ°", "Park walk ğŸŒ³", "Scenic view ğŸŒ†", "Arcade ğŸ®"] },
      { key:"Vibe",   text: "What kind of date vibe do you want? âœ¨", answers: ["Romantic ğŸ’•", "Fun & playful ğŸ˜„", "Chill & cozy ğŸ§¸", "Adventurous ğŸš—", "Quiet & gentle ğŸŒ™"] },
      { key:"Gift",   text: "What gift would make you smile? ğŸ", answers: ["Flowers ğŸŒ¹", "Chocolates ğŸ«", "Stuffed toy ğŸ§¸", "A surprise ğŸ˜", "Handwritten note ğŸ’Œ"] },
      { key:"Photos", text: "Should we take cute pictures together? ğŸ“¸", answers: ["Of course! ğŸ˜", "Maybe a few ğŸ™‚", "Only if I look good ğŸ˜Œ", "Letâ€™s do candid shots ğŸ«¶ğŸ»"] },
      { key:"Drive",  text: "Would you prefer a long drive date or a short one? ğŸš—", answers: ["Long drive ğŸš—", "Short drive ğŸš˜", "Either, as long as itâ€™s with you ğŸ¥¹"] }
    ];

    let currentQuestion = 0;
    const answersChosen = [];

    function startQuestions(){
      document.getElementById('intro').classList.add('fadeOut');

      setTimeout(() => {
        document.getElementById('intro').classList.add('hidden');
        document.getElementById('quiz').classList.remove('hidden');
        document.getElementById('stepText').textContent = 'Answer honestly ğŸ˜‰';
        showQuestion();
        toast("Letâ€™s go ğŸ’Œ");
      }, 340);
    }

    function showQuestion(){
      const q = questions[currentQuestion];
      document.getElementById('questionText').textContent = q.text;

      document.getElementById('progressLabel').textContent =
        `Question ${currentQuestion + 1} of ${questions.length}`;

      const progress = (currentQuestion / questions.length) * 100;
      document.getElementById('progressBar').style.width = progress + '%';

      const answerContainer = document.getElementById('answerButtons');
      answerContainer.innerHTML = '';

      q.answers.forEach(a => {
        const btn = document.createElement('button');
        btn.className = 'secondary';
        btn.textContent = a;
        btn.onclick = () => nextQuestion(a);
        answerContainer.appendChild(btn);
      });

      const backBtn = document.getElementById('backBtn');
      backBtn.disabled = currentQuestion === 0;
      backBtn.style.opacity = backBtn.disabled ? .55 : 1;
    }

    function nextQuestion(answer){
      answersChosen[currentQuestion] = answer;
      currentQuestion++;

      if(currentQuestion < questions.length){
        showQuestion();
      } else {
        document.getElementById('progressBar').style.width = '100%';
        showFinal();
      }
    }

    function goBack(){
      if(currentQuestion === 0) return;
      currentQuestion--;
      showQuestion();
    }

    function restart(){
      currentQuestion = 0;
      answersChosen.length = 0;
      showQuestion();
      toast("Restarted âœ¨");
    }

    function skipToPick(){
      document.getElementById('intro').classList.add('fadeOut');
      setTimeout(() => {
        document.getElementById('intro').classList.add('hidden');
        document.getElementById('quiz').classList.add('hidden');
        showFinal();
      }, 340);
    }

    function showFinal(){
      document.getElementById('quiz').classList.add('hidden');
      document.getElementById('final').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'Pick date & time ğŸ’Œ';

      // defaults: tomorrow + 7pm
      const dateEl = document.getElementById('datePick');
      const timeEl = document.getElementById('timePick');
      const now = new Date();
      const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
      dateEl.value = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth()+1).padStart(2,'0')}-${String(tomorrow.getDate()).padStart(2,'0')}`;
      timeEl.value = "19:00";
      toast("Pick your schedule â°");
    }

    function backToQuiz(){
      // If they never started quiz, go intro
      if (answersChosen.length === 0 && currentQuestion === 0){
        document.getElementById('final').classList.add('hidden');
        document.getElementById('intro').classList.remove('hidden');
        document.getElementById('stepText').textContent = 'A tiny date quiz';
        return;
      }
      document.getElementById('final').classList.add('hidden');
      document.getElementById('quiz').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'Answer honestly ğŸ˜‰';
      showQuestion();
    }

    function backToFinal(){
      document.getElementById('extraMessage').classList.add('hidden');
      document.getElementById('final').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'Pick date & time ğŸ’Œ';
    }

    function goToExtraMessage(){
      const dateVal = document.getElementById('datePick').value;
      const timeVal = document.getElementById('timePick').value;

      if(!dateVal || !timeVal){
        alert("Please pick both a date and time ğŸ«¶ğŸ»");
        return;
      }

      document.getElementById('final').classList.add('hidden');
      document.getElementById('extraMessage').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'A little note ğŸ’—';
      toast("Just a small message ğŸ«¶ğŸ»");
    }

    function formatDatePretty(yyyy_mm_dd){
      if(!yyyy_mm_dd) return '';
      const [y, m, d] = yyyy_mm_dd.split('-').map(Number);
      const dt = new Date(y, m - 1, d);
      return dt.toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' });
    }

    function formatTimePretty(hh_mm){
      if(!hh_mm) return '';
      const [hh, mm] = hh_mm.split(':').map(Number);
      const dt = new Date();
      dt.setHours(hh, mm, 0, 0);
      return dt.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
    }

    // Suggest common "nice" times
    function suggestTimes(){
      const t = document.getElementById('timePick');
      const picks = ["18:30","19:00","19:30","20:00"];
      const choice = picks[Math.floor(Math.random()*picks.length)];
      t.value = choice;
      toast(`Suggested: ${formatTimePretty(choice)} âœ¨`);
    }

    // Typewriter effect for message
    let typing = false;
    function typeMessage(){
      if (typing) return;
      typing = true;

      const el = document.getElementById('messageBody');
      const full =
        "I know life gets busy, but I just want you to know: Iâ€™m proud of you.\n" +
        "Iâ€™m not here to rush youâ€”only to choose you, gently, every day.\n\n" +
        "If you say yes, Iâ€™ll make it simple, sweet, and very you. ğŸ«¶ğŸ»";

      el.textContent = "";
      let i = 0;

      const tick = () => {
        el.textContent += full[i] || "";
        i++;
        if (i < full.length){
          setTimeout(tick, 18);
        } else {
          typing = false;
          toast("ğŸ¥¹");
        }
      };
      tick();
    }

    // Move from message -> Valentine question
    function goToValentine(){
      const dateVal = document.getElementById('datePick').value;
      const timeVal = document.getElementById('timePick').value;

      if(!dateVal || !timeVal){
        alert("Please pick both a date and time ğŸ«¶ğŸ»");
        return;
      }

      document.getElementById('extraMessage').classList.add('hidden');
      document.getElementById('valentine').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'Final question ğŸ˜Œ';

      const btn = document.getElementById('noBtn');
      if(btn) btn.style.transform = 'translate(0px, 0px)';

      toast("Final question ğŸ’–");
    }

    // Love Receipt
    function goToLoveReceipt(){
      const dateVal = document.getElementById('datePick').value;
      const timeVal = document.getElementById('timePick').value;

      if(!dateVal || !timeVal){
        alert("Please pick both a date and time ğŸ«¶ğŸ»");
        return;
      }

      const prettyDate = formatDatePretty(dateVal);
      const prettyTime = formatTimePretty(timeVal);

      const rows = questions.map((q, i) => {
        const v = answersChosen[i] || "â€”";
        return `<div class="row"><div class="k">${q.key}</div><div class="v">${v}</div></div>`;
      }).join("");

      const dtRows = `
        <div class="row"><div class="k">Date</div><div class="v">${prettyDate}</div></div>
        <div class="row"><div class="k">Time</div><div class="v">${prettyTime}</div></div>
      `;

      document.getElementById('loveReceiptBox').innerHTML = `
        <strong>Receipt details âœ¨</strong>
        <div style="height:10px"></div>
        ${rows}
        ${dtRows}
      `;

      document.getElementById('valentine').classList.add('hidden');
      document.getElementById('loveReceiptPage').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'Almost there ğŸ’Œ';

      document.getElementById('celebrate').classList.add('hidden');
      toast("Looks perfect? ğŸ’Œ");
    }

    function backToValentine(){
      document.getElementById('loveReceiptPage').classList.add('hidden');
      document.getElementById('valentine').classList.remove('hidden');
      document.getElementById('stepText').textContent = 'Final question ğŸ˜Œ';
      toast("Back ğŸ«¶ğŸ»");
    }

    function burstHearts(count = 18){
      for (let i = 0; i < count; i++){
        const h = document.createElement('div');
        h.textContent = (Math.random() > 0.5) ? 'ğŸ’–' : 'ğŸ’•';
        h.style.position = 'fixed';
        h.style.left = (50 + (Math.random()*30 - 15)) + 'vw';
        h.style.top  = (55 + (Math.random()*20 - 10)) + 'vh';
        h.style.fontSize = (18 + Math.random()*18) + 'px';
        h.style.opacity = '0.95';
        h.style.transform = 'translate(-50%, -50%)';
        h.style.pointerEvents = 'none';
        h.style.zIndex = 90;

        const x = (Math.random()*240 - 120);
        const y = -(120 + Math.random()*160);
        const r = (Math.random()*30 - 15);

        h.animate([
          { transform:`translate(-50%, -50%) translate(0px,0px) rotate(0deg)`, opacity: .95 },
          { transform:`translate(-50%, -50%) translate(${x}px,${y}px) rotate(${r}deg)`, opacity: 0 }
        ], { duration: 900 + Math.random()*500, easing: 'cubic-bezier(.2,.8,.2,1)' });

        document.body.appendChild(h);
        setTimeout(() => h.remove(), 1500);
      }
    }

    function confirmEverything(){
      document.getElementById('celebrate').classList.remove('hidden');
      document.getElementById('footerReceipt').textContent = "See you on our date, I'm so excited ğŸ’•";
      burstHearts(26);
      toast("Confirmed ğŸ’");
    }

    // moving "No" so it can't be clicked
    function moveNo(){
      const btn = document.getElementById('noBtn');
      if(!btn) return;

      const x = Math.floor(Math.random() * 180) - 90;
      const y = Math.floor(Math.random() * 140) - 70;
      btn.style.transform = `translate(${x}px, ${y}px)`;
    }

    function noTry(){
      const btn = document.getElementById('noBtn');
      if(!btn) return;
      btn.classList.remove('shake');
      void btn.offsetWidth;
      btn.classList.add('shake');
      toast("Hehe nice try ğŸ˜œ");
    }

    // Copy receipt to clipboard
    async function copyReceipt(){
      const dateVal = document.getElementById('datePick').value;
      const timeVal = document.getElementById('timePick').value;

      const lines = [];
      lines.push("ğŸ’Œ Our Little Love Receipt");
      lines.push("");
      questions.forEach((q, i) => lines.push(`${q.key}: ${answersChosen[i] || "â€”"}`));
      lines.push(`Date: ${formatDatePretty(dateVal)}`);
      lines.push(`Time: ${formatTimePretty(timeVal)}`);
      lines.push("");
      lines.push("â€” Made for BbubğŸ«¶ğŸ»");

      try{
        await navigator.clipboard.writeText(lines.join("\n"));
        toast("Copied ğŸ“‹");
      } catch(e){
        alert("Copy failed ğŸ¥º (Some browsers block clipboard on local files.)");
      }
    }

    // Mini menu modal
    function openMiniMenu(){
      document.getElementById('miniMenu').classList.add('show');
    }
    function closeMiniMenu(){
      document.getElementById('miniMenu').classList.remove('show');
    }
    document.getElementById('miniMenu').addEventListener('click', (e) => {
      if (e.target.id === 'miniMenu') closeMiniMenu();
    });

    function toggleAmbience(){
      ambienceOn = !ambienceOn;
      setAmbienceVisible(ambienceOn);
      document.getElementById('ambienceTitle').textContent = `Ambience: ${ambienceOn ? "ON" : "OFF"}`;
      toast(ambienceOn ? "Ambience on ğŸŒ™" : "Ambience off â˜€ï¸");
      closeMiniMenu();
    }

    function surpriseCompliment(){
      const lines = [
        "Youâ€™re genuinely my favorite kind of peace. ğŸ«¶ğŸ»",
        "If being cute was a job, youâ€™d be CEO. ğŸ˜Œ",
        "I like youâ€¦ a lot. Like, a lot-lot. ğŸ’—",
        "You make ordinary days feel special. âœ¨",
        "Iâ€™ll always choose you gently. ğŸŒ™"
      ];
      toast(lines[Math.floor(Math.random()*lines.length)]);
      closeMiniMenu();
    }

    function jumpToReceipt(){
      // Quick jump: if they haven't picked date/time yet, open pick page
      const dateVal = document.getElementById('datePick').value;
      const timeVal = document.getElementById('timePick').value;

      // hide all pages
      ["intro","quiz","final","extraMessage","valentine","loveReceiptPage"].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });

      if(!dateVal || !timeVal){
        document.getElementById('final').classList.remove('hidden');
        document.getElementById('stepText').textContent = 'Pick date & time ğŸ’Œ';
        toast("Pick date/time first ğŸ«¶ğŸ»");
      } else {
        // build receipt
        document.getElementById('valentine').classList.remove('hidden');
        document.getElementById('stepText').textContent = 'Final question ğŸ˜Œ';
        toast("Back to the question ğŸ˜Œ");
      }
      closeMiniMenu();
    }
  </script>
</body>
</html>
